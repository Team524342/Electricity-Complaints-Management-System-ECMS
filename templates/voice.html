    <!-- Voice Recording Section -->
     <form>
                        <div class="mb-3 border p-3 rounded bg-light">
                            <h5>Voice Complaint</h5>
                            <p class="small text-muted">Record your complaint instead of typing. Click Start to begin recording.</p>
                            
                            <div id="voice-controls" class="d-flex gap-2 mb-2">
                                <button type="button" id="startRecording" class="btn btn-sm btn-success">
                                    <i class="fas fa-microphone"></i> Start Recording
                                </button>
                                <button type="button" id="stopRecording" class="btn btn-sm btn-danger" disabled>
                                    <i class="fas fa-stop"></i> Stop Recording
                                </button>
                            </div>
                            
                            <div id="recording-status" class="mb-2">
                                <span class="badge bg-secondary">Not recording</span>
                                <span id="timer" class="badge bg-info d-none">00:00</span>
                            </div>
                            
                            <div id="transcript-container" class="mb-2 d-none">
                                <p class="small fw-bold">Transcript:</p>
                                <div id="transcript-text" class="p-2 border rounded bg-white"></div>
                                <input type="hidden" name="voice_used" id="voice_used" value="0">
                            </div>
                            
                            <div class="progress mb-2 d-none" id="processing-progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                            </div>
                            
                            <p id="recording-error" class="text-danger small d-none"></p>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">Submit Complaint</button>
                            <a href="{{ url_for('user_dashboard') }}" class="btn btn-secondary">Cancel</a>
                        </div>
 </form>
 <!-- Add this script to the bottom of submit_complaint.html -->
<script>
let mediaRecorder;
let audioChunks = [];
let timerInterval;
let seconds = 0;

document.addEventListener('DOMContentLoaded', function() {
    const startButton = document.getElementById('startRecording');
    const stopButton = document.getElementById('stopRecording');
    const recordingStatus = document.getElementById('recording-status');
    const timer = document.getElementById('timer');
    const transcriptContainer = document.getElementById('transcript-container');
    const transcriptText = document.getElementById('transcript-text');
    const processingProgress = document.getElementById('processing-progress');
    const recordingError = document.getElementById('recording-error');
    const descriptionField = document.getElementById('description');
    const voiceUsedField = document.getElementById('voice_used');
    
    function updateTimer() {
        seconds++;
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        timer.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    }
    
    startButton.addEventListener('click', async () => {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];
            
            mediaRecorder.addEventListener('dataavailable', event => {
                audioChunks.push(event.data);
            });
            
            mediaRecorder.addEventListener('stop', async () => {
                // Reset the UI
                recordingStatus.innerHTML = '<span class="badge bg-warning">Processing...</span>';
                processingProgress.classList.remove('d-none');
                
                // Create the audio blob and send it to the server
                const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                
                const formData = new FormData();
                formData.append('audio_data', audioBlob);
                
                try {
                    const response = await fetch('/process_voice_complaint', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        processingProgress.classList.add('d-none');
                        recordingStatus.innerHTML = '<span class="badge bg-success">Recording processed</span>';
                        
                        // Show transcript and update description field
                        transcriptContainer.classList.remove('d-none');
                        transcriptText.textContent = result.transcript;
                        descriptionField.value = result.transcript;
                        voiceUsedField.value = "1";
                        
                    } else {
                        processingProgress.classList.add('d-none');
                        recordingStatus.innerHTML = '<span class="badge bg-danger">Processing failed</span>';
                        recordingError.textContent = result.error;
                        recordingError.classList.remove('d-none');
                    }
                } catch (error) {
                    processingProgress.classList.add('d-none');
                    recordingStatus.innerHTML = '<span class="badge bg-danger">Processing failed</span>';
                    recordingError.textContent = "Error sending audio: " + error.message;
                    recordingError.classList.remove('d-none');
                }
                
                // Stop all tracks of the stream to release the microphone
                stream.getTracks().forEach(track => track.stop());
            });
            
            // Start recording
            mediaRecorder.start();
            
            // Update UI
            startButton.disabled = true;
            stopButton.disabled = false;
            recordingStatus.innerHTML = '<span class="badge bg-danger">Recording...</span>';
            timer.classList.remove('d-none');
            recordingError.classList.add('d-none');
            
            // Start timer
            seconds = 0;
            timer.textContent = "00:00";
            timerInterval = setInterval(updateTimer, 1000);
            
        } catch (error) {
            console.error('Error accessing microphone:', error);
            recordingError.textContent = "Could not access microphone. Please check your browser permissions.";
            recordingError.classList.remove('d-none');
        }
    });
    
    stopButton.addEventListener('click', () => {
        if (mediaRecorder && mediaRecorder.state !== 'inactive') {
            mediaRecorder.stop();
            clearInterval(timerInterval);
            
            // Update UI
            startButton.disabled = false;
            stopButton.disabled = true;
        }
    });
});
</script>
{% endblock %}

    